package com.aragron.weapon_pool.streams_api.domain;

import com.aragron.weapon_pool.streams_api.domain.domain.WinnerGuess;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.List;
import java.util.stream.Collectors;

/**
 * åŠŸèƒ½æè¿°: Streamsåˆæ¢
 *
 * @Author: aragron
 * @Create: 2018/7/29-12:29
 * @Home: http://aragron.com
 */
public class Client {
    static List<WinnerGuess> init() {
        return Arrays.asList(
                new WinnerGuess("Konie", "13122631111", 2, 11, "æ­å·", "é˜¿æ ¹å»·", "æ¢…è¥¿"),
                new WinnerGuess("Alex", "13122632222", 2, 12, "ä¸Šæµ·", "æ³•å›½", "å‡¯æ©"),
                new WinnerGuess("Aragron", "13122633333", 1, 13, "ä¸Šæµ·", "å¾·å›½", "æ¢…è¥¿"),
                new WinnerGuess("Rachel", "13122634444", 2, 14, "æ·±åœ³", "æ³•å›½", "Cç½—"),
                new WinnerGuess("Lexi", "13122635555", 2, 20, "æ­¦æ±‰", "æ³•å›½", "é½è¾¾å†…"),
                new WinnerGuess("Mike", "13122636666", 1, 19, "æ­¦æ±‰", "å·´è¥¿", "Cç½—"),
                new WinnerGuess("May", "13122637777", 2, 18, "æ·±åœ³", "æ³•å›½", "æ¢…è¥¿"),
                new WinnerGuess("Fairy", "13122638888", 2, 17, "æ­¦æ±‰", "è¥¿ç­ç‰™", "æ¢…è¥¿"),
                new WinnerGuess("Emily", "13122639999", 2, 16, "ä¸Šæµ·", "æ³•å›½", "Cç½—"),
                new WinnerGuess("Kevin", "13122630000", 1, 15, "ä¸Šæµ·", "å¾·å›½", "æ¢…è¥¿"),
                new WinnerGuess("Merry", "13122630001", 2, 10, "æ³°å›½", "ä¿„ç½—æ–¯", "æ¢…è¥¿")
        );
    }

    public static void main(String[] args) {
        //å‡†å¤‡ç«çŒœè®°å½•æ•°æ®(è™šæ„)âš½ï¸ã€å‰æ®µæ—¶é—´çš„ä¸–ç•Œæ¯å¤ªç«äº†ï¼Œæ‰€ä»¥ä¸šåŠ¡åœºæ™¯ä¸ºæœŸé—´çš„ç«çŒœ(ä¸šåŠ¡å¥½ç†è§£)ï¼Œä¸»è¦ä¸ºäº†è¯´æ˜Streamsã€‘
        List<WinnerGuess> winnerGuesses = init();

        /**éœ€æ±‚ä¸€ï¼šç«çŒœæœ€ä½³å°„æ‰‹ä¸ºæ¢…è¥¿(bestPlayerä¸ºæ¢…è¥¿)çš„ç”¨æˆ·æœ‰å“ªäº›*/
        List<String> names_guessed_Messi = winnerGuesses.stream()//è½¬æ¢ä¸ºstream
                .filter(winnerGuess -> "æ¢…è¥¿".equals(winnerGuess.getBestPlayer()))//è¿‡æ»¤ï¼Œæœ€ä½³å°„æ‰‹ä¸ºæ¢…è¥¿ğŸ§”
                .map(winnerGuess -> {//è½¬æ¢ï¼Œé€‰æ‹©ä¸€
                    return winnerGuess.getName();//è·å–ç«çŒœç”¨æˆ·çš„å§“å
                })
                //.map(winnerGuess -> winnerGuess.getName())//å¯¹ä¸Šé¢çš„ç®€å†™
                //.map(WinnerGuess::getName)//é€‰æ‹©äºŒ(æ¶‰åŠåˆ°æ–¹æ³•å¼•ç”¨)ï¼Œè·å–ç«çŒœç”¨æˆ·çš„å§“å
                .collect(Collectors.toList());//æ±‡æ€»ï¼Œå°†è¿‡æ»¤åçš„ç”¨æˆ·å§“åæ±‡æ€»ï¼Œè¿”å›ä¸ºä¸€ä¸ªlist
        System.out.println("ç«çŒœæœ€ä½³å°„æ‰‹ä¸ºæ¢…è¥¿çš„ç”¨æˆ·æœ‰ï¼š" + names_guessed_Messi);

        /**éœ€æ±‚äºŒï¼šç«çŒœæœ€ä½³å°„æ‰‹ä¸ºCç½—(bestPlayerä¸ºCç½—)çš„ç”¨æˆ·æœ‰å‡ ä¸ª*/
        long count_guessed_C = winnerGuesses.stream()//è½¬æ¢ä¸ºstream
                .filter(winnerGuess -> "Cç½—".equals(winnerGuess.getBestPlayer()))//è¿‡æ»¤ï¼Œæœ€ä½³å°„æ‰‹ä¸ºCç½—ğŸ‘¶
                .count();//æ±‡æ€»ï¼Œå°†è¿‡æ»¤åçš„ç”¨æˆ·æ±‚å’Œï¼Œè¿”å›ä¸ªæ•°
        System.out.println("ç«çŒœæœ€ä½³å°„æ‰‹ä¸ºCç½—çš„ç”¨æˆ·æœ‰" + count_guessed_C + "ä¸ª");

        /**éœ€æ±‚ä¸‰ï¼šæ˜¯å¦æœ‰æ¥è‡ªæ³°å›½çš„ç«çŒœè€…*/
        boolean hasUserThailand = winnerGuesses.parallelStream().anyMatch(winnerGuess -> "æ³°å›½".equals(winnerGuess.getCity()));
        System.out.println(hasUserThailand);

        /**éœ€æ±‚å››ï¼šç»™æ€§åˆ«ä¸ºå¥³(sexç­‰äº2)ä¸”æ¥è‡ªäºä¸Šæµ·(cityä¸ºæ·±åœ³)ä¸”ç«çŒœçš„å† å†›çƒé˜Ÿä¸ºæ³•å›½(winnerTeamä¸ºæ³•å›½)çš„ç”¨æˆ·æ¯äººå‘ä¸€æ¡çŸ­ä¿¡ï¼Œ
         çŸ­ä¿¡å†…å®¹ä¸ºï¼šHiï¼Œxxxï¼Œæ­å–œä½ ç«çŒœå† å†›æˆåŠŸï¼Œ100wå¥–é‡‘å°†ä¼šåœ¨ä½ xx(å½“å‰å¹´é¾„åŠ 1)å²ç”Ÿæ—¥ğŸ‚ï¼Œæ‰“åˆ°ä½ çš„è´¦æˆ·ï¼Œåˆ°æ—¶è¯·æ³¨æ„æŸ¥æ”¶ï¼*/
        winnerGuesses.stream()//è½¬æ¢ä¸ºstream
                .filter(winnerGuess -> "æ·±åœ³".equals(winnerGuess.getCity()))//è¿‡æ»¤ï¼Œæ¥è‡ªæ·±åœ³ğŸŒˆ
                .filter(winnerGuess -> winnerGuess.getSex().equals(2))//è¿‡æ»¤ï¼Œå¥³å­©ğŸ‘©
                .map(winnerGuess -> {//è½¬æ¢
                    winnerGuess.setAge(winnerGuess.getAge() + 1);//å¹´é¾„åŠ 1
                    return winnerGuess;
                })
                .sorted(Comparator.comparing(WinnerGuess::getAge).reversed())//æ’åºï¼Œå¹´é¾„å‡åº
                .limit(2)//å‰2ä½ç«çŒœè€…
                .parallel()//è½¬æ¢ä¸ºå¹¶è¡Œstream(å¹¶è¡Œæ“ä½œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸cpuæ•ˆèƒ½)
                .forEach(winnerGuess -> sendMobileMsg(winnerGuess));//ç»™æ¯ä¸ªç”¨æˆ·å‘é€çŸ­ä¿¡
        /**
         1.è¿™ä¸ªéœ€æ±‚æ˜¯streams apiã€jkd8æ‰èƒ½ã€‘çš„ä¸€ç§å…¸å‹ç”¨æ³•ï¼Œè‡ªå·±å·¥ä½œä¸­ç»å¸¸ä¹Ÿè¿™æ ·ç”¨
         2.æƒ³æƒ³å¦‚æœæ˜¯jkd8ä¹‹å‰è¦å†™è¿™æ ·çš„é€»è¾‘ï¼Œè¦å†™å¤šå°‘forå¾ªç¯ï¼Œå¤šå°‘ifï¼Œå¤šå°‘æ— æ„ä¹‰çš„ä¸­é—´å˜é‡ï¼Œç„¶è€Œæœ‰äº†streams apiï¼Œä¸€è¡Œä»£ç å°±æå®šäº†ï¼Œè€Œä¸”æ›´ç®€æ´ï¼Œè¡¨è¾¾æ€§æ›´å¼º
         3.ğŸ’£ğŸ’£ğŸ’£ğŸ’£ä¸è¿‡éœ€è¦è‡ªå·±æ¢å¥½è¡ŒğŸ’£ğŸ’£ğŸ’£ğŸ’£ï¼Œä¸ç„¶çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯å¤´å¤§ğŸ¶ğŸ¶ğŸ¶
         4.å…¶å®filter-map-reduceæ˜¯ç°åœ¨å…ˆè¡Œè®¡ç®—æœºè¡Œä¸šé€šç”¨çš„æ€æƒ³ï¼Œç„¶åç»“åˆlambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼ç¼–ç¨‹(ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºä¹‹åˆ—ï¼Œä¸è¿‡å¾…ä¼šå¯ä»¥ç»™å‡ºç›¸åº”çš„èµ„æ–™å‚è€ƒé“¾æ¥ğŸ”—)
         ä½¿ç”¨åï¼Œä½ ä¼šè§‰å¾—ç¼–ç¨‹åˆç¾å¥½äº†ä¸€äº›ã€‚
         â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©â›©*/

        /**
         * å¯¹streamæ“ä½œç±»å‹ï¼Œæœ‰ä¸‰ç§ï¼š
         *      1.Intermediate(è‹±æ–‡æ„æ€ä¸ºï¼Œä¸­é—´)
         *          filterã€mapã€distinctã€sortedã€peekã€limitã€skipã€parallelã€sequentialã€unorderedï¼Œ
         *          ã€å¼•ç”¨ã€‘ã€ğŸ”—è§æ–‡æœ«ã€‘ä¸€ä¸ªæµå¯ä»¥åé¢è·Ÿéšé›¶ä¸ªæˆ–å¤šä¸ª intermediate æ“ä½œã€‚å…¶ç›®çš„ä¸»è¦æ˜¯æ‰“å¼€æµï¼Œåšå‡ºæŸç§ç¨‹åº¦çš„æ•°æ®æ˜ å°„/è¿‡æ»¤ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„æµï¼Œ
         *           äº¤ç»™ä¸‹ä¸€ä¸ªæ“ä½œä½¿ç”¨ã€‚è¿™ç±»æ“ä½œéƒ½æ˜¯æƒ°æ€§åŒ–çš„ï¼ˆlazyï¼‰ï¼Œå°±æ˜¯è¯´ï¼Œä»…ä»…è°ƒç”¨åˆ°è¿™ç±»æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å¼€å§‹æµçš„éå†ã€‚
         *      2.Terminal
         *          forEachã€forEachOrderedã€toArrayã€reduceã€collectã€minã€maxã€countã€anyMatchã€allMatchã€noneMatchã€findFirstã€findAnyã€iterator
         *          ã€ğŸ”—ã€‘ä¸€ä¸ªæµåªèƒ½æœ‰ä¸€ä¸ª terminal æ“ä½œï¼Œå½“è¿™ä¸ªæ“ä½œæ‰§è¡Œåï¼Œæµå°±è¢«ä½¿ç”¨â€œå…‰â€äº†ï¼Œæ— æ³•å†è¢«æ“ä½œã€‚æ‰€ä»¥è¿™å¿…å®šæ˜¯æµçš„æœ€åä¸€ä¸ªæ“ä½œã€‚
         *           Terminal æ“ä½œçš„æ‰§è¡Œï¼Œæ‰ä¼šçœŸæ­£å¼€å§‹æµçš„éå†ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ªç»“æœï¼Œæˆ–è€…ä¸€ä¸ª side effectã€‚
         *      3.short-circuiting
         *          anyMatchã€allMatchã€noneMatchã€findFirstã€findAnyã€limit
         *          ã€ğŸ”—ã€‘ç”¨ä»¥æŒ‡ï¼š
         *           å¯¹äºä¸€ä¸ª intermediate æ“ä½œï¼Œå¦‚æœå®ƒæ¥å—çš„æ˜¯ä¸€ä¸ªæ— é™å¤§ï¼ˆinfinite/unboundedï¼‰çš„ Streamï¼Œä½†è¿”å›ä¸€ä¸ªæœ‰é™çš„æ–° Streamã€‚
         *           å¯¹äºä¸€ä¸ª terminal æ“ä½œï¼Œå¦‚æœå®ƒæ¥å—çš„æ˜¯ä¸€ä¸ªæ— é™å¤§çš„ Streamï¼Œä½†èƒ½åœ¨æœ‰é™çš„æ—¶é—´è®¡ç®—å‡ºç»“æœã€‚
         *
         * ã€â—ğŸ”—ã€‘æ³¨æ„ï¼š
         *      åœ¨å¯¹äºä¸€ä¸ª Stream è¿›è¡Œå¤šæ¬¡è½¬æ¢æ“ä½œ (Intermediate æ“ä½œ)ï¼Œæ¯æ¬¡éƒ½å¯¹ Stream çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ï¼Œè€Œä¸”æ˜¯æ‰§è¡Œå¤šæ¬¡ï¼Œ
         *      è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±æ˜¯ Nï¼ˆè½¬æ¢æ¬¡æ•°ï¼‰ä¸ª for å¾ªç¯é‡ŒæŠŠæ‰€æœ‰æ“ä½œéƒ½åšæ‰çš„æ€»å’Œå—ï¼Ÿå…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œè½¬æ¢æ“ä½œéƒ½æ˜¯ lazy çš„ï¼Œ
         *      å¤šä¸ªè½¬æ¢æ“ä½œåªä¼šåœ¨ Terminal æ“ä½œçš„æ—¶å€™èåˆèµ·æ¥ï¼Œä¸€æ¬¡å¾ªç¯å®Œæˆã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç®€å•çš„ç†è§£ï¼ŒStream é‡Œæœ‰ä¸ªæ“ä½œå‡½æ•°çš„é›†åˆï¼Œ
         *      æ¯æ¬¡è½¬æ¢æ“ä½œå°±æ˜¯æŠŠè½¬æ¢å‡½æ•°æ”¾å…¥è¿™ä¸ªé›†åˆä¸­ï¼Œåœ¨ Terminal æ“ä½œçš„æ—¶å€™å¾ªç¯ Stream å¯¹åº”çš„é›†åˆï¼Œç„¶åå¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ‰€æœ‰çš„å‡½æ•°ã€‚
         */

        /**
         * è‡³äºä¸ºä»€ä¹ˆæ²¡å¸¸è§„å»ä»‹ç»å…ˆä»€ä¹ˆæ˜¯streamï¼Œä»€ä¹ˆæ˜¯lambdaå•¥çš„ï¼Œæ˜¯å› ä¸ºç½‘ä¸Šæœ‰å¥½å¤šå¥½æ–‡ç« ã€ğŸ”—ã€‘å·²ç»è§£é‡Šæ¸…æ¥šäº†ï¼Œä¸å¿…ç´¯è¿°
         * ç›¸ä¿¡èªæ˜çš„ä½ çœ‹çœ‹åº”è¯¥å°±å¤§ä½“ä¸ŠçŸ¥é“æ˜¯å•¥æ„æ€ï¼Œå…ˆä¸Šè½¦ğŸš—å†è¯´ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ç”¨ç€ç”¨ç€å°±é¢†æ‚Ÿäº†ï¼Œç¼–ç¨‹æ›´æ˜¯å¦‚æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« ç›®çš„ä¸»è¦æ˜¯ï¼Œè®©è¿˜æ²¡ç”¨ä¸Šjdk8çš„ï¼Œ
         * ç”¨äº†jdk8è¿˜å¯¹streamè¿Ÿç–‘çš„ç«¥é‹æ—©ç”¨æ—©äº«å—ğŸ˜ƒ
         * ã€ğŸ”—ã€‘å”¯æœ‰å†™å‡ºäººç±»å®¹æ˜“ç†è§£çš„ä»£ç ï¼Œæ‰æ˜¯ä¼˜ç§€çš„ç¨‹åºå‘˜ï¼
         * ç¥å¤§å®¶çœ‹å¾—æ˜ç™½ï¼Œç©å¾—æ„‰å¿«ï¼
         */

        /**
         * stream debug
         */

        /**
         * stream ä¸Šè½¦æŠ€å·§
         *      å‡å¦‚ï¼Œåˆšå¼€å§‹ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆç”¨å¸¸è§„forå»å®ç°ï¼Œç„¶åå€ŸåŠ©IDEAçš„æ™ºèƒ½ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆstreamè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼Œéœ€æ±‚ä¸€å¯ä»¥æ”¹å†™ä¸‹:
         *      æŒ‰ç…§æ­¥éª¤æ“ä½œåï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆğŸ˜‹
         */
        /**éœ€æ±‚ä¸€ï¼šç«çŒœæœ€ä½³å°„æ‰‹ä¸ºæ¢…è¥¿(bestPlayerä¸ºæ¢…è¥¿)çš„ç”¨æˆ·æœ‰å“ªäº›*/
        List<String> names_guessed_Messi_old = new ArrayList<>();
        for (int i = 0; i < winnerGuesses.size(); i++) {
            if ("æ¢…è¥¿".equals(winnerGuesses.get(i).getBestPlayer()))
                names_guessed_Messi_old.add(winnerGuesses.get(i).getName());
        }

        /**
         * é“¾æ¥ã€ğŸ”—ã€‘
         */
    }

    /**
     * ç»™ç”¨æˆ·å‘é€çŸ­ä¿¡ã€è¿™é‡Œç”¨æ‰“å°æ›¿ä»£ã€‘
     *
     * @param winnerGuess
     */
    private static void sendMobileMsg(WinnerGuess winnerGuess) {
        System.out.println("Hiï¼Œ" + winnerGuess.getName() + "ï¼Œæ­å–œä½ ç«çŒœå† å†›æˆåŠŸï¼Œ100wå¥–é‡‘å°†ä¼šåœ¨ä½ " + winnerGuess.getAge() +
                "å²ç”Ÿæ—¥\uD83C\uDF82ï¼Œæ‰“åˆ°ä½ çš„è´¦æˆ·ï¼Œåˆ°æ—¶è¯·æ³¨æ„æŸ¥æ”¶ï¼");
    }


}
